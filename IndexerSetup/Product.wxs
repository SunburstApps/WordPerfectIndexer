<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:swid="http://schemas.microsoft.com/wix/TagExtension">
  <Product Id="*" Name="WordPerfect Indexer" Language="1033" Version="1.0.0.0" Manufacturer="Sunburst Solutions" UpgradeCode="225be42d-9e5d-4d81-84e3-9b6f2eaa2d1e">
    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" Platform="x64" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <Feature Id="ProductFeature" Title="WordPerfect Indexer" Level="1">
      <ComponentRef Id="ProductComponent" />
      <ComponentRef Id="ProductComponent64" />
    </Feature>

    <Property Id="ARPNOMODIFY" Value="1" />
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="WordPerfect Indexer" />
      </Directory>
    </Directory>

    <DirectoryRef Id="INSTALLFOLDER">
      <Component Id="ProductComponent" Guid="{3DF2827D-0BAF-456A-8320-00F3AE5B9969}">
        <File Id="librevenge.dll" Name="librevenge.dll" Source="$(var.SolutionDir)\Release\librevenge.dll" />
        <File Id="libwpd.dll" Name="libwpd.dll" Source="$(var.SolutionDir)\Release\libwpd.dll" />
        <File Id="wpd2text.exe" Name="wpd2text.exe" Source="$(var.SolutionDir)\Release\wpd2text.exe" />
        <File Id="zlib.dll" Name="zlib1.dll" Source="$(var.SolutionDir)\Release\zlib1.dll" />
        <File Id="WordPerfectIndexer.dll" Name="WordPerfectIndexer.dll" KeyPath="yes" Source="$(var.SolutionDir)\Release\WordPerfectIndexer.dll">
          <TypeLib Id="{FAABE005-73E7-4015-895D-B9B1E30BF26A}" Description="WordPerfect Indexer Type Library" Language="0" MajorVersion="1" MinorVersion="0">
            <Class Id="{F4EF307D-BCFC-4DC5-821D-31B77E0A5011}" Context="InprocServer32" Description="WordPerfect Filter" ThreadingModel="both" Version="1.0" />
          </TypeLib>
        </File>

        <RegistryValue Root="HKCR" Key=".wpd\PersistentHandler" Value="{D1A975AB-725A-4804-ADC1-4BC3DB60621C}" Type="string" Action="write" />
        <RegistryValue Root="HKCR" Key="CLSID\{D1A975AB-725A-4804-ADC1-4BC3DB60621C}\PersistentAddinsRegistered\{89BCB740-6119-101A-BCB7-00DD010655AF}" Value="{F4EF307D-BCFC-4DC5-821D-31B77E0A5011}" Type="string" Action="write" />
        <RegistryValue Root="HKCR" Key="CLSID\{D1A975AB-725A-4804-ADC1-4BC3DB60621C}\PersistentAddinsRegistered" Value="" Type="string" Action="write" />
      </Component>
    </DirectoryRef>
  </Fragment>

  <Fragment>
    <DirectoryRef Id="INSTALLFOLDER">
      <Directory Id="INSTALLFOLDER64" Name="x64" />
    </DirectoryRef>

    <Component Id="ProductComponent64" Guid="{53B6D32C-2A5D-4AEE-AF9D-AA3FBE5CD6FE}" Directory="INSTALLFOLDER64">
      <File Id="librevenge64.dll" Name="librevenge.dll" Source="$(var.SolutionDir)\x64\Release\librevenge.dll" />
      <File Id="libwpd64.dll" Name="libwpd.dll" Source="$(var.SolutionDir)\x64\Release\libwpd.dll" />
      <File Id="wpd2text64.exe" Name="wpd2text.exe" Source="$(var.SolutionDir)\x64\Release\wpd2text.exe" />
      <File Id="zlib64.dll" Name="zlib1.dll" Source="$(var.SolutionDir)\x64\Release\zlib1.dll" />

      <File Id="WordPerfectIndexer64.dll" Name="WordPerfectIndexer.dll" KeyPath="yes" Source="$(var.SolutionDir)\Release\WordPerfectIndexer.dll">
        <TypeLib Id="{FAABE005-73E7-4015-895D-B9B1E30BF26A}" Description="WordPerfect Indexer Type Library" Language="0" MajorVersion="1" MinorVersion="0">
          <Class Id="{F4EF307D-BCFC-4DC5-821D-31B77E0A5011}" Context="InprocServer32" Description="WordPerfect Filter" ThreadingModel="both" Version="1.0" />
        </TypeLib>
      </File>
    </Component>
  </Fragment>

  <Fragment>
    <Component Id="PropertySchema" Guid="{C5D8E5A7-9DE1-48DB-A8AD-46B28D9B1FE6}" Directory="INSTALLFOLDER">
      <File Id="WordPerfectIndexer.propdesc" Name="WordPerfectIndexer.propdesc" Source="$(var.SolutionDir)\WordPerfectIndexer\WordPerfectIndexer.propdesc" />
    </Component>

    <CustomAction Id="RegisterPropdesc" BinaryKey="PropdescExt" DllEntry="RegisterPropDescFile" Execute="immediate" Return="check" />
    <Binary Id="PropdescExt" SourceFile="$(var.IndexerSetup.RegisterProperties.TargetPath)" />

    <InstallExecuteSequence>
      <Custom Action="RegisterPropdesc" After="InstallFiles" />
    </InstallExecuteSequence>
  </Fragment>
</Wix>
